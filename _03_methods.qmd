# Methods

The inputs to housing affordability are complex and, often times, intertwined.

#### Rental vs Home Ownership - An Early Project Decision Point
The aim of this project was to primarily look into unaffordable housing and housing consists, primarily, of 2 kinds
of housed individuals:  those who rent and those who own a home.  To decide if we should be focused on both rental unit prices and current home sales, we looked at the
current affordability strategies and compared them with our data to determine the most immediate need.

##### Evaluation of the current rental situation:
About 33% of Oregonians rent, based on the most up-to-date U.S. Census numbers (Oregonâ€™s Homeownership Rate, n.d.).  We evaluated, `median_rent_2bdrm` vs `monthly_affordable_housing_payment` county-by-county
to assess whether Oregonians are paying an unaffordable amount of rent each month.  You can see in the graph below that rental prices sit comfortably under the maximum affordable threshold.  Becuase of this, we decided to focus
on home sale prices for the rest of our analysis.
<br><br><br>

```{python}
#| label: fig-rent-affordability
#| fig-cap: "Median rent for a 2 bedroom vs Maximum affordable housing price"


import pandas as pd
import plotly.graph_objs as go
import plotly.express as px
from plotly.subplots import make_subplots

# Load the dataset
file_path = 'housing_engineered.csv'
housing_data_engineered = pd.read_csv(file_path)

# Convert the date column to datetime format
housing_data_engineered['date'] = pd.to_datetime(housing_data_engineered['date'])

# Get unique list of counties
counties = housing_data_engineered['county'].unique()

# Create initial figure
fig = make_subplots()

# Add traces for the initial county (first county in the list)
initial_county_data = housing_data_engineered[housing_data_engineered['county'] == counties[0]]
fig.add_trace(go.Scatter(x=initial_county_data['date'], y=initial_county_data['median_rent_2bdrm'], mode='lines', name='Median Rent 2 Bedroom'))
fig.add_trace(go.Scatter(x=initial_county_data['date'], y=initial_county_data['monthly_affordable_housing_payment'], mode='lines', name='Monthly Affordable Housing Payment'))

# Update plot sizing
fig.update_layout(
    template="plotly_white",
)

# Update layout with dropdown
dropdown_buttons = [
    {
        'args': [{'y': [housing_data_engineered[housing_data_engineered['county'] == county]['median_rent_2bdrm'],
                        housing_data_engineered[housing_data_engineered['county'] == county]['monthly_affordable_housing_payment']],
                 'x': [housing_data_engineered[housing_data_engineered['county'] == county]['date'],
                       housing_data_engineered[housing_data_engineered['county'] == county]['date']],
                 'type': 'scatter'}],
        'label': county,
        ''
        'method': 'update'
    }
    for county in counties
]

layout = dict(
   buttons = dropdown_buttons,
   direction =  'down',
   showactive = True,
   yanchor="top",
   y=0.99,
   xanchor="left",
   x=0.01
)

fig.update_layout(
    updatemenus=[
        layout
    ]
)

# Update axis labels and title
fig.update_layout(
    title='Oregon County Rentals have Managed to Stay Affordable</i>',
    xaxis_title='Date',
    yaxis_title='Monthly Rental Payment (U.S. Dollars)',
)

# Show the plot
fig.show()
```


#### Project Design

##### 1. Research and Identification of Core Strategies
We began by conducting a comprehensive review of current strategies employed to address housing affordability. This
review focused on identifying the fundamental objectives these strategies aimed to achieve, such as increasing housing inventory,
stabilizing rental prices, and enhancing accessibility for low-income households.  The result of this review is a list of strategies
with their intended goal, seen in the dropdown below.  Using this strategy-goal list, we asked both Anthropic's Claude AI and OpenAI's
ChatGPT to analyze our dataset and to tag each strategy goal with both direct and indirect associations to the dataset features.  We then
curated the responses into a set of features to use to compare to the results of our analysis.

::: {.callout-note collapse="true"}
## Strategy Goal List - Click to Expand
| **Goal**                                         | **Explanation**                                                                                                                        | 
|--------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| **Inclusionary Zoning**                          | Policies require developers to include affordable housing units in new projects.                                                       |
| **Density Bonuses**                              | Developers can build more units than normally allowed in exchange for including affordable housing units.                               |
| **Tax Increment Financing (TIF)**                | Uses future gains in property taxes to finance current improvements, such as affordable housing developments.                           |
| **Low-Income Housing Tax Credits (LIHTC)**       | Provides tax credits to private developers for building or rehabilitating affordable rental housing.                                    |
| **Community Land Trusts (CLTs)**                 | Nonprofit organizations acquire and hold land to ensure it remains affordable for housing.                                              | 
| **Public-Private Partnerships**                  | Collaboration between government agencies and private developers to create affordable housing projects.                                 |
| **Rent Control and Stabilization**               | Limits the amount by which rents can increase annually.                                                                                 |
| **Accessory Dwelling Units (ADUs)**              | Smaller, independent residential units located on the same lot as a single-family home.                                                 |
| **Housing Vouchers**                             | Programs like Section 8 provide subsidies to low-income households to help them afford rental housing in the private market.            |
| **Streamlining Permitting and Reducing Regulations** | Simplifying the permitting process and reducing unnecessary regulations can lower the cost and time required to build housing.          |
| **Land Banking**                                 | Land banks acquire, hold, and manage vacant or underutilized land for future development of affordable housing.                         |
| **Increased Funding for Affordable Housing Programs** | Increasing funding for affordable housing programs can support the construction and maintenance of affordable units.                     |
| **Supportive Housing**                           | Combines affordable housing with on-site services to help individuals with special needs, such as those experiencing homelessness.      |
:::

::: {.callout-note collapse="true"}
## Anthropic Claud AI feature tagging - Click to Expand
### Goals and Associated Features in the Dataset
| Goal | Directly Associated Features | Indirectly Associated Features |
|------|------------------------------|--------------------------------|
| Increase affordable housing stock | `inventory`, `new_listings` | `median_sale_price`, `homes_sold` |
| Encourage affordable housing development | `new_listings` | `median_sale_price`, `inventory` |
| Fund affordable housing projects | N/A | `median_income`, `property_tax` |
| Incentivize private investment in affordable housing | N/A | `new_listings`, `homes_sold` |
| Maintain long-term affordability | N/A | `median_sale_price`, `average_sale_to_list` |
| Develop affordable housing efficiently | `new_listings`, `days_on_market` | `inventory` |
| Protect tenants from rent increases | N/A | `median_rent_2bdrm`, `median_income` |
| Increase affordable rental supply | `inventory`, `new_listings` | `median_rent_2bdrm`, `rental_vacancy` |
| Subsidize housing for low-income families | N/A | `median_income`, `median_rent_2bdrm` |
| Encourage more housing construction | `new_listings`, `homes_sold` | `inventory`, `days_on_market` |
| Ensure land use for affordable housing | N/A | `inventory`, `new_listings` |
| Support affordable housing programs | N/A | `median_income`, `population` |
| Provide housing and services for vulnerable populations | N/A | `population`, `median_income` |
:::

::: {.callout-note collapse="true"}
## OpenAI ChatGPT feature tagging - Click to Expand
### Goals and Associated Features in the Dataset

| Goal Description                                 | Directly Associated Features                        | Indirectly Associated Features                     |
|--------------------------------------------------|----------------------------------------------------|---------------------------------------------------|
| **Inclusionary Zoning**                          | `median_rent_2bdrm`, `median_sale_price`            | `num_housing_units`, `population`, `median_income` |
| **Density Bonuses**                              | `median_rent_2bdrm`, `median_sale_price`            | `new_listings`, `homes_sold`, `num_housing_units`  |
| **Tax Increment Financing (TIF)**                | `property_tax`, `median_sale_price`                 | `median_income`, `population`, `num_housing_units` |
| **Low-Income Housing Tax Credits (LIHTC)**       | `median_rent_2bdrm`, `median_sale_price`            | `median_income`, `population`, `num_housing_units` |
| **Community Land Trusts (CLTs)**                 | `median_rent_2bdrm`, `median_sale_price`            | `num_housing_units`, `median_income`, `population` |
| **Public-Private Partnerships**                  | `median_rent_2bdrm`, `median_sale_price`            | `homes_sold`, `new_listings`, `num_housing_units`  |
| **Rent Control and Stabilization**               | `median_rent_2bdrm`                                 | `median_income`, `population`, `num_housing_units` |
| **Accessory Dwelling Units (ADUs)**              | `median_rent_2bdrm`, `median_sale_price`            | `new_listings`, `num_housing_units`                |
| **Housing Vouchers**                             | `median_rent_2bdrm`                                 | `median_income`, `population`, `num_housing_units` |
| **Streamlining Permitting and Reducing Regulations** | `new_listings`, `homes_sold`                        | `num_housing_units`, `median_rent_2bdrm`, `median_sale_price` |
| **Land Banking**                                 | `num_housing_units`, `median_sale_price`            | `population`, `median_income`                      |
| **Increased Funding for Affordable Housing Programs** | `median_rent_2bdrm`, `median_sale_price`            | `num_housing_units`, `median_income`, `population` |
| **Supportive Housing**                           | `median_rent_2bdrm`, `median_sale_price`            | `median_income`, `population`, `num_housing_units` |
:::

<br><br>
##### 2. Data Exploration and Analysis


### Fill this out with python used, specific tests run

* **Trend Analysis**: Examined temporal trends in affordability for both rental and housing prices to determine the feasibility and relevance of analyzing both sectors concurrently.
    + Mann-Kendal test for trend significance and direction
* **Correlation and Significance Testing**: Analyzed feature correlations and performed significance tests to identify key predictors of target variables (rent and median sale price).
* **Feature Importance Analysis**: Employed the `permutation_importance` function from the `sklearn` library to ascertain the importance of various features. A Random Forest Regressor model was constructed and evaluated to validate these findings.

##### 3. Identification of Significant Features
We identified the intersection of features with significant linear regression p-values and those deemed most important by the Random Forest model. This intersection provided robust evidence of features that were statistically correlated with housing prices. Subsequently, we compared these features with the strategies identified in the initial research phase to draw meaningful insights.

##### 4. Forecasting Housing Prices
Finally, leveraging the optimal Random Forest model, we developed a time series forecast to predict future housing prices. This predictive model aided in anticipating market trends and formulating effective strategies to enhance housing affordability.

## Stastical Analysis
Python 3.12.4 was used for data processing, statistical analysis, and plots for this study.  We performed descriptive analysis on the features in this dataset and we noted the lack of data
in some counties for earlier years.



Raw data

The first step was to research housing affordability trends in Oregon and determine what steps have been taken to keep housing affordable for Oregonians.
With this set of approaches, we wanted to identify the specific issues they are trying to solve - are they trying to help builders obtain land and build
faster?  Rent control?  Subsidies for builders to build more affordably?  We need to make a determination if the features they are trying to solve for
are represented in our data.  Maybe if they are trying to build up more inventory, num_housing_units or inventory is a good indicator.  Relaxing land use laws
or stretching the urban barrier seem to be an effort to increase inventory/num_housing_units.

Counties may represent features differently.  Aggregating by county, do scatter plots and linear regression to obtain p-values for each feature
measured against median_sale_price.  Look for features that are correlated and ensure there is no multicolinearity among them.

Now we have sets of features that represent 99% of the homes sold and are not multicolinear.  Are there common features among them?


--Aggregate to county level to get a more localized look at what is going on
The path to take here should probably be looking at several methods of feature importance and try to go with an intersecting set
of those features.  Build linear regression and a couple of ML models using those features.  If the models work out, we could say that these
features are significant and could be looked at as factors to take into account when looking into various types legislation.

1.  Looked at linear correlations with pearson correlation and linear regression measuring r^2 and p-value for significance.
1a. Mann-Kendall Trend - to look for significance of trends in housing and income over our timespan
2.  Created Linear Model to look at the affects of inventory and housing units on median sales prices.  Tested all
assumptions of linear regression to ensure the model was accurate.
3.  Created Random Forest, evaluated for error and accuracy.
4.  Created a timeseries forecast model using Random Forest.


Feature Engineering
1.  Engineered several features:
- median monthly payment consisting of average mortgage rate, number of payments (30 years), 80% of the median sale price
- unaffordability index - ratio of median sale price and median income (used in at least one article found - look up reference)


The methods used in this analysis consists of simple stastical analysis for correlations and time series trends, a random forest model, and a random forest model with time series data

